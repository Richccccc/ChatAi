# 训练和使用流程

## 完整流程概览

```
1. 训练模型 → 2. 启动服务 → 3. Spring Boot调用 → 4. 前端调用
```

---

## 第一步：训练模型

### 方式1：单独训练（推荐）

```bash
python train_model.py
```

**训练过程：**
1. 加载数据文件 `fake_job_postings.csv`
2. 数据预处理和特征工程
3. 训练3个模型：
   - Random Forest（随机森林）
   - Gradient Boosting（梯度提升）
   - Logistic Regression（逻辑回归）
4. 保存模型到 `model` 文件夹

**保存的文件：**
```
model/
├── Random_Forest.pkl              # 随机森林模型
├── Gradient_Boosting.pkl          # 梯度提升模型
├── Logistic_Regression.pkl        # 逻辑回归模型
├── Logistic_Regression_scaler.pkl # 逻辑回归标准化器
├── metadata.pkl                   # 模型元数据
├── label_encoders.pkl             # 分类特征编码器
└── feature_stats.pkl              # 特征统计信息
```

### 方式2：一键训练并启动服务

```bash
python train_and_start.py
```

这会：
1. 检查是否已有模型文件
2. 如果没有，自动训练模型
3. 训练完成后，询问是否启动服务
4. 如果选择是，自动启动预测服务

---

## 第二步：启动Python预测服务

### 方式1：使用启动脚本（推荐）

**Windows:**
```bash
start_service.bat
```

**Linux/Mac:**
```bash
chmod +x start_service.sh
./start_service.sh
```

### 方式2：手动启动

```bash
python model_service.py
```

**服务信息：**
- 地址：`http://localhost:5000`
- 健康检查：`GET /health`
- 预测接口：`POST /predict`
- 批量预测：`POST /predict/batch`

---

## 第三步：Spring Boot集成

### 1. 确保Python服务已启动

```bash
# 测试服务是否运行
curl http://localhost:5000/health
```

### 2. 在Spring Boot中调用

参考 `说明/Spring Boot集成指南.md` 进行集成：

- 创建DTO类（JobPredictionRequest、JobPredictionResponse）
- 创建Service类（PythonModelService）
- 创建Controller类（JobPredictionController）
- 配置application.yml

### 3. 测试Spring Boot接口

```bash
curl -X POST http://localhost:8080/api/job-prediction/predict \
  -H "Content-Type: application/json" \
  -d '{"title": "Software Engineer", ...}'
```

---

## 第四步：前端调用

前端通过Spring Boot后端调用预测接口：

```javascript
// Vue.js示例
const response = await axios.post('/api/job-prediction/predict', {
  title: 'Software Engineer',
  location: 'US, CA, San Francisco',
  salary_range: '120000-180000',
  // ... 其他字段
});
```

---

## 完整示例流程

### 1. 训练模型

```bash
# 进入项目目录
cd d:\model

# 训练模型
python train_model.py
```

**输出：**
```
============================================================
正在加载数据...
============================================================
数据加载完成，共 17880 条记录

正在预处理数据...
正在提取特征...
特征提取完成！

正在准备模型特征...
特征准备完成！特征数量: 25, 样本数量: 17880

============================================================
开始训练模型...
============================================================

训练 Random_Forest...
...
AUC Score: 0.9234

正在保存模型到 model 文件夹...
  ✓ 已保存: model\Random_Forest.pkl
  ✓ 已保存: model\Gradient_Boosting.pkl
  ✓ 已保存: model\Logistic_Regression.pkl
  ✓ 已保存: model\Logistic_Regression_scaler.pkl
  ✓ 已保存: model\metadata.pkl
  ✓ 已保存: model\label_encoders.pkl
  ✓ 已保存: model\feature_stats.pkl

所有模型文件已保存到 model 文件夹！
```

### 2. 启动服务

```bash
# Windows
start_service.bat

# 或手动启动
python model_service.py
```

**输出：**
```
============================================================
启动职位虚假检测模型服务
============================================================

正在从 model 加载模型...
  ✓ 已加载模型: model\Random_Forest.pkl
  ✓ 已加载元数据: model\metadata.pkl
  ✓ 已加载LabelEncoder: model\label_encoders.pkl
  ✓ 已加载特征统计: model\feature_stats.pkl
模型加载完成！

服务启动中...
API接口:
  GET  /health          - 健康检查
  POST /predict         - 单个职位预测
  POST /predict/batch   - 批量职位预测

服务地址: http://localhost:5000
============================================================
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
```

### 3. 测试服务

```bash
# 健康检查
curl http://localhost:5000/health

# 预测
curl -X POST http://localhost:5000/predict \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Software Engineer",
    "location": "US, CA, San Francisco",
    "salary_range": "120000-180000",
    "company_profile": "We are a leading company...",
    "description": "We are looking for...",
    "requirements": "Bachelor degree...",
    "benefits": "Health insurance",
    "telecommuting": 0,
    "has_company_logo": 1,
    "has_questions": 1,
    "employment_type": "Full-time",
    "required_experience": "Mid-Senior level",
    "required_education": "Bachelor'\''s Degree",
    "industry": "Computer Software",
    "function": "Engineering"
  }'
```

### 4. Spring Boot调用

参考 `说明/Spring Boot集成指南.md` 中的代码示例

---

## 常见问题

### Q1: 训练模型需要多长时间？
**A**: 取决于数据量，通常几分钟到十几分钟

### Q2: 模型文件有多大？
**A**: 每个模型文件大约几MB到几十MB

### Q3: 可以只训练一个模型吗？
**A**: 可以修改 `train_model.py`，只训练需要的模型

### Q4: 训练后如何更新模型？
**A**: 重新运行 `python train_model.py`，会覆盖旧的模型文件

### Q5: 模型文件可以移动吗？
**A**: 可以，但需要同时移动整个 `model` 文件夹，包括所有 `.pkl` 文件

---

## 快速参考

| 操作 | 命令 |
|------|------|
| 训练模型 | `python train_model.py` |
| 一键训练并启动 | `python train_and_start.py` |
| 启动服务（Windows） | `start_service.bat` |
| 启动服务（Linux/Mac） | `./start_service.sh` |
| 手动启动服务 | `python model_service.py` |
| 健康检查 | `curl http://localhost:5000/health` |

---

## 文件依赖关系

```
train_model.py
    ↓ 生成
model/ (文件夹)
    ├── Random_Forest.pkl
    ├── Gradient_Boosting.pkl
    ├── Logistic_Regression.pkl
    ├── Logistic_Regression_scaler.pkl
    ├── metadata.pkl
    ├── label_encoders.pkl
    └── feature_stats.pkl
    ↓ 被加载
model_service.py
    ↓ 提供API
Spring Boot后端
    ↓ 提供API
前端应用
```

---

## 注意事项

1. **训练顺序**：必须先训练模型，才能启动服务
2. **文件完整性**：`model` 文件夹下的所有文件都是必需的，不要删除
3. **路径一致性**：确保 `model_service.py` 中的 `model_dir` 路径正确
4. **端口占用**：确保5000端口未被占用
5. **Python版本**：建议使用Python 3.7+

